@page
@model IndexModel
@inject ChatX.Models.AccessControl accessControl
@{
    ViewData["Title"] = "Home page";
    
}


<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="~/js/signalr/dist/browser/signalr.js"></script>
<script defer src="~/js/chat.js"></script>


<main>
    <div id="app">
        <div class="container">

            <div v-if="!connected">
                <p>Connecting to server...</p>
            </div>

            <div v-else>

                <h1>ChatX</h1>
                <div class="list-container" v-for="message in messages" :key="message.id">
                    <div id="userMsg" v-if="message.sender === @accessControl.LoggedInAccountID">
                        <p>@accessControl.LoggedInAccountName: {{ message.content }}</p>
                        @foreach(var url in Model.FileUrls)
                        {
                            <img src="@url" style="width:300px">
                        }
                        @if (Model.FileUrls.Count == 0)
                        {
                            <p>You have not uploaded any photos yet.</p>
                        }
                        <button class="delete-mark" v-on:click="deleteMessage(message.id)"></button>
                    </div>
                    <div id="msg" v-else>
                        <p>{{ message.senderName }} {{ message.content }}</p>
                    </div>
                </div>

                <form v-on:submit.prevent="sendMessage">
                    <input id="messageInput" type="text" v-model="newMessage" />
                    <button id="sendButton">Send</button>
                </form>

              
                 <form id="fileForm" method="post" enctype="multipart/form-data">
                        
                    
                    <div id="upload-container">
                        
                        <input type="file" id="fileInput" name="file" />
                        <button>Upload</button>

                    </div>

                        

                 </form>
               

            </div>
        </div>
    </div>
</main>

<script>var loggedInUser = @accessControl.LoggedInAccountID</script>
<script>var loggedInUserName = "@accessControl.LoggedInAccountName"</script>